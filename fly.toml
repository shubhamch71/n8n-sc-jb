# fly.toml - Fly.io configuration for n8n job alerts
# Deploy with: fly launch / fly deploy

app = "n8n-job-alerts"
primary_region = "iad"

[build]
  image = "docker.n8n.io/n8nio/n8n:latest"

[env]
  N8N_HOST = "0.0.0.0"
  N8N_PORT = "5678"
  N8N_PROTOCOL = "https"
  NODE_ENV = "production"
  GENERIC_TIMEZONE = "UTC"
  TZ = "UTC"
  EXECUTIONS_DATA_SAVE_ON_ERROR = "all"
  EXECUTIONS_DATA_SAVE_ON_SUCCESS = "all"
  EXECUTIONS_DATA_SAVE_MANUAL_EXECUTIONS = "true"
  EXECUTIONS_DATA_PRUNE = "true"
  EXECUTIONS_DATA_MAX_AGE = "168"
  DB_TYPE = "sqlite"
  DB_SQLITE_VACUUM_ON_STARTUP = "true"
  N8N_DIAGNOSTICS_ENABLED = "false"
  N8N_BASIC_AUTH_ACTIVE = "true"

[http_service]
  internal_port = 5678
  force_https = true
  auto_stop_machines = false
  auto_start_machines = true
  min_machines_running = 1
  processes = ["app"]

[[http_service.checks]]
  interval = "30s"
  timeout = "5s"
  grace_period = "30s"
  method = "GET"
  path = "/healthz"

[mounts]
  source = "n8n_data"
  destination = "/home/node/.n8n"
  initial_size = "1gb"

[[vm]]
  cpu_kind = "shared"
  cpus = 1
  memory_mb = 512
